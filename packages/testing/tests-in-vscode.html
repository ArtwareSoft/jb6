<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script type="importmap">
  VS_CODE_IMPORT_MAP
</script>
<link rel="icon" href="@jb6/testing/jbart-tests.png" type="image/png">
<style>
	.test-button { opacity: 0 }
	.test-button:hover { opacity: 1 }
</style>

</head>
<body>
	<div id="remoteTests"> </div>

	<div id="mem"> </div>
	<div id="testElem"> </div>
	<div id="show"> </div>
 <script type="module">
    const query_params = QUERY_PARAMS_JSON
    const urlQuery = prop => query_params[prop]

    const { coreUtils } = await import('@jb6/core')
    const { runTests } = await import('@jb6/testing')
    const modulePath = urlQuery('modulePath') || '/all-tests.js'
    console.log('modulePath', modulePath)
    await import(modulePath)

    if (urlQuery('probe')) {
      const { waitForReact, reactUtils } = await import('@jb6/react')
      const { h } = reactUtils
      waitForReact() // start loading react
      const { } = await import('@jb6/core/utils/probe.js')
      const { runProbeCli } = coreUtils
      const probeRes = await runProbeCli(urlQuery('probe'), urlQuery('entryPoint') || modulePath)
      await waitForReact()
      const { probeResultView } = await import('./probe-ui.js')
      ReactDOM.createRoot(show).render(h(probeResultView,{probeRes}))
    } else {
      const params = { 
        specificTest: urlQuery('test'),
        notPattern: urlQuery('not'),
        ...Object.fromEntries(['pattern','take'].map(x=>[x,urlQuery(x)]))
      }
      runTests(params)
    }
  </script>
</body>
</html>